import { Link } from '@brillout/docpress'
import { UiFrameworkVikeExtension, UiFrameworkVikeExtensionNames } from '../components'

To set `<head>` tags, such as `<title>` and `<meta name="description">`, you can use:

- <Link href="#head-title">The settings `<Head>` and `title`</Link> (page-by-page basis)
- :construction: <Link href="#usehead">The `useHead()` component hook</Link> (component-by-component basis)

## `<Head>` + `title`

To set `<head>` tags applied to all pages by default:

```jsx
// /pages/+Head.jsx or
// /pages/+Head.vue
// Environment: server

export { Head }

import { socialImage } from '../assets/images/socialImage.jpg'
import { favicon } from '../assets/images/favicon.png'

function Head() {
  return <>
    <meta charset="utf-8" />
    {/* Don't do this:
    <title>SpaceX</title>
    */}
    <meta name="description" content="We deliver payload to space.">
    <meta property="og:image" content={socialImage} />
    <link rel="icon" href={favicon} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </>
}
```

Don't set `<title>SpaceX<title>` in `<Head>`, use the setting `title` instead:

```js
// /pages/+title.js
// Environment: server, client

export const title = 'SpaceX'
```

> The setting `title` does two things:
>  - It sets the page's title by adding the HTML tag `<title>Space</title>` upon rendering the page to HTML.
>  - It updates the page's title by calling [`document.tilte = 'SpaceX'`](https://developer.mozilla.org/en-US/docs/Web/API/Document/title) upon client-side navigation.
>
> Setting `<title>SpaceX</title>` using `<Head>` would correctly set the page's title for the first page the user visits, but it wouldn't update the page's title upon <Link href="/client-routing">client-side navigation</Link>.
>
> A tag such as the social image tag `<meta property="og:image">` is read only by crawlers (browsers don't do anything with it). Crawlers only fetch HTML and don't execute JavaScript and don't client-side navigate. This means that `<meta property="og:image">` doesn't need to be updated upon client-side navigation.

To set page-specific `<head>` tags based on <Link href="/data-fetching">fetched data</Link>:

```js
// /pages/product/starship/+data.js
// Environment: server

export { data }

async function data() {
  const product = await sql.run(
    'SELECT { title, description, social_image } FROM products WHERE name = "starship";'
  )
  return { product }
}
```
```jsx
// /pages/product/starship/+Head.jsx
// Environment: server

export { Head }

import { useData } from 'vike/react' // or 'vike-vue' / 'vike-solid'

// Overrides the default <Head> above set by /pages/+Head.jsx
function Head() {
  const { product } = useData()
  return <>
    <meta name="description" content={product.description}>
    <meta property="og:image" content={product.social_image}>
  </>
}
```
```js
// /pages/product/starship/+title.jsx
// Environment: server, client

export { title }

import { useData } from 'vike/react' // or 'vike-vue' / 'vike-solid'

// Instead of setting title to a string, we set it to function,
// enabling us to use component hooks such as useData()
function title() {
  const { product } = useData()
  return product.title
}
```

> The settings `<Head>` and `title` are provided by the <UiFrameworkVikeExtension />.
> See <Link href="#without-vike-extension" /> if you don't use <UiFrameworkVikeExtensionNames />.


## `useHead()`

The upcoming `useHead()` component hook will enable any UI component to add `<head>` tags, see: [New component hook `useHead()`](https://github.com/vikejs/vike-react/issues/67).


## Without Vike extension

If you don't use a Vike extension, then you have direct control over `<head>` tags in your [`onRenderHtml()` hook](/onRenderHtml).

```js
// /renderer/+onRenderHtml.js
// Environment: server

import { escapeInject, dangerouslySkipEscape } from 'vike/server'
import { renderToHtml } from 'some-ui-framework'

export { onRenderHtml }

async function onRenderHtml(pageContext) {
  return escapeInject`<html>
    <head>
      <title>SpaceX</title>
      <meta name="description" content="We deliver payload to space.">
    </head>
    <body>
      <div id="root">
        ${dangerouslySkipEscape(await renderToHtml(pageContext.Page))}
      </div>
    </body>
  </html>`
}
```


### By page

To define `<head>` tags on page-by-page basis, we recommend creating new settings, for example `title` and `description` as shown at <Link href="/meta#example-title-and-description" doNotInferSectionTitle />.


### By component

To define `<head>` tags by any UI component:
 1. Add `'headProps'` to [`passToClient`](/passToClient).
 2. Access `pageContext.headProps` (using <Link href="/usePageContext">`usePageContext()`</Link>) and modify it in the UI component.

For example:

```js
// /renderer/+onRenderHtml.js
// Environment: server

export { onRenderHtml }

import { escapeInject, dangerouslySkipEscape } from 'vike/server'
import renderToHtml from 'some-ui-framework'

async function onRenderHtml(pageContext) {
  // We use our UI framework to pass `pageContext.headProps` to all components
  // of our component tree. (E.g. React Context or Vue's `app.config.globalProperties`.)
  const pageHtml = await renderToHtml(
    <ContextProvider headProps={pageContext.headProps} >
      <Page />
    </ContextProvider>
  )

  // 1. One of our UI component modified pageContext.headProps while rendering components.
  // 2. We now render `headProps` to HTML meta tags.
  return escapeInject`<html>
    <head>
      <title>${pageContext.headProps.title}</title>
      <meta name="description" content="${pageContext.headProps.description}">
    </head>
    <body>
      <div id="app">
        ${dangerouslySkipEscape(pageHtml)}
      </div>
    </body>
  </html>`
}
```

```js
// SomeComponent.js


  // Inside a UI component
  const pageContext = usePageContext()
  headProps.title = 'I was set by some component.'
  headProps.description = 'Me too.'
```


### Client Routing

If you use Client Routing, make sure to update `document.title` upon page navigation:

```js
// /renderer/+config.h.js
// Environment: config

export default {
  // Make pageContext.headProps available on the client-side.
  passToClient: ['headProps']
}
```

```js
// /renderer/+onRenderClient.js
// Environment: client

export { onRenderClient }

async function onRenderClient(pageContext) {
  if (!pageContext.isHydration) {
    // Client-side navigation â€” we update the page's title
    document.title = pageContext.headProps.title
  }
  // ...
}
```


### Libraries

You can also use libraries such as [@vueuse/head](https://github.com/vueuse/head) or [react-helmet](https://github.com/nfl/react-helmet).

But we recommend using such library only if you have a rationale as the aforementioned solutions are simpler.

Head libraries already sanitize the HTML `<head>`, this means you can skip `escapeInject` and wrap the overall result with `dangerouslySkipEscape()`.

```js
// /renderer/+onRenderHtml.js
// Environment: server

export { onRenderHtml }

import { dangerouslySkipEscape } from 'vike/server'
import { renderToHtml } from 'some-ui-framework'

async function onRenderHtml(pageContext) {
  return dangerouslySkipEscape(await renderToHtml(pageContext.Page))
}
```


## See also

- <Link href="/data-fetching" />
- <Link href="/markdown#metadata" />
