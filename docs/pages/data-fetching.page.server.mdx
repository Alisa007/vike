import { RepoLink, Link } from '@brillout/docpress'
import { UiFrameworkVikeExtension, UiFrameworkVikeExtensionNames } from '../components'


## `data()`

The usual way to fetch data is to use a <Link href="/data">`data()`</Link> hook with <Link href="/useData">`useData()`</Link>.

```js
// /pages/movies/@id/+data.js
// Environment: server

export { data }

import fetch from 'node-fetch'

async function data(pageContext) {
  const { id } = pageContext.routeParams
  const response = await fetch(`https://star-wars.brillout.com/api/films/${id}.json`)
  let movies = await response.json()
  // `movies` is serialized and passed to the client. Therefore, we pick only the
  // data the client needs in order to minimize what is sent over the network.
  movies = movies.map(({ title, release_date }) => ({ title, release_date }))

  // data() runs only on the server-side by default, therefore we can use ORM/SQL queries.
  /* With an ORM:
  const movies = await Movie.findAll({ select: ['title', 'release_date'] }) */
  /* With SQL:
  const movies = await sql.run('SELECT { title, release_date } FROM movies;') */

  return {
    movies
  }
}
```

> The `@id` in the path `/pages/movie/@id/+data.js` denotes a route parameter which value is available at `pageContext.routeParams.id`, see <Link href="/routing" />.

```js
// /pages/movies/@id/components/SomeComponent.js
// Environment: server, client

import { useData } from 'vike-react'
/* Or:
import { useData } from 'vike-vue'
import { useData } from 'vike-solid'
*/

// ...

  // Inside any UI component
  const data = useData()
  const { name, price } = data
```

> `useData()` is provided by the <UiFrameworkVikeExtension />. If you don't use <UiFrameworkVikeExtensionNames /> then see <Link href="/data#without-usedata" doNotInferSectionTitle />.


## `data()` error handling

To gracefully handle errors, use <Link href="/render" text={<code>throw render()</code>}></Link> and/or <Link href="/redirect" text={<code>throw redirect()</code>}></Link>:

```js
// /pages/movies/+data.js
// Environment: server

export { data }

import fetch from 'node-fetch'

async function data(pageContext) {
  const response = await fetch('https://movies.example.org/api')

  if (response.status === 404) {
    // Render the error page and show error message
    throw render(404, `Movie with ID ${movieId} doesn't exist.`)
    /* Or redirect the user:
    throw redirect('/movie/add')
    */
    /* Or render the movie submission form while preserving the URL:
    throw render('/movie/add')
    */
  }

  // ...
}
```

Vike renders the <Link text="error page" href="/error-page" /> upon `throw render(404)`.

> Using `throw render('/movie/add')` instead of `throw redirect('/movie/add')` is a technique explained at <Link href="/auth#login-flow" />.


## RPC

RPC (aka "Server Actions"), enable you to call backend functions remotely and seamlessly from your frontend, see <Link href="/RPC" />.

In general, we recommend using RPC to perform data mutations, while using `data()` for fetching data.

> Instead of using a `data()` hook, you'll soon also be able to use [Telefunc](https://telefunc.com) to fetch data.


## GraphQL

With Vike, you can manually integrate GraphQL tools yourself, giving you complete control over the integration. See:

- <Link href="/apollo-graphql" />
- <Link href="/relay" />
- <Link href="/urql" />

> In addtion to manual integration, you will soon also have the option to use Vike Extensions for automatic integration. See [#1373 - Vike Extensions: GraphQL](https://github.com/vikejs/vike/issues/1373).


## Store (Vuex/Redux...)

With Vike, you can manually integrate state management stores yourself, giving you complete control over the integration. See:

- <Link href="/redux" />
- <Link href="/vuex" />
- <Link href="/pinia" />
- <Link href="/pullstate" />

> In addtion to manual integration, you will soon also have the option to use Vike Extensions for automatic integration. See [#1374 - Vike Extensions: Data Management Stores (Redux, Vuex, ...)](https://github.com/vikejs/vike/issues/1374).


## See also

- <Link href="/api-routes" />
- <Link href="/RPC" />
- <Link href="/data" />
- <Link href="/useData" />
- <Link href="/pageContext" />
- <Link href="/onBeforeRender" />
- <Link href="/render" />
- <Link href="/redirect" />
